<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title></title>
    <style type="text/css">
        #div1 {
            position: absolute;
            top: 0;
            left: 0;
            width: 100px;
            height: 100px;
            background: gold;
            cursor: move;
        }
    </style>
</head>
<body>
<div id="div1"></div>
<script src="event3-self.js" type="text/javascript" charset="utf-8"></script>
<script>

    //实现初始化
    //原来面向过程的drag方法里，this指的是被拖拽的元素,但是在面向对象的drag里，this是指的这个类的实例，并且在完成这个类上的所有的方法时，都遵循这个原则
    function Drag(ele) {   //ele是被拖拽的DOM对象
        this.ele = ele;  //被拖拽的元素保存在自己的实例上
        this.x = null;
        this.y = null;
        this.mx = null;
        this.my = null;
        this.DOWN = processThis(this.down, this);
        this.MOVE = processThis(this.move, this);
        this.UP = processThis(this.up, this);
        on(this.ele, "mousedown", this.DOWN);  //this.down方法里的this会按着事件绑定的原则来处理,即this指向this.ele
    }

    Drag.prototype.down = function (e) {
        this.x = this.ele.offsetLeft;
        this.y = this.ele.offsetTop;
        this.mx = e.pageX;
        this.my = e.pageY;

        if (this.ele.setCapture) {
            this.ele.setCapture();
            on(this.ele, "mousemove", this.MOVE);
            on(this.ele, "mouseup", this.UP);
        } else {
            on(document, "mousemove", this.MOVE);
            on(document, "mouseup", this.UP);
        }
        e.preventDefault(); //阻止默认行为
    }

    Drag.prototype.move = function (e) {
        this.ele.style.left = this.x + (e.pageX - this.mx) + "px";
        this.ele.style.top = this.y + (e.pageY - this.my) + "px";
    }

    Drag.prototype.up = function () {
        if (this.ele.releaseCapture) {
            this.ele.releaseCapture();
            off(this.ele, "mousemove", this.MOVE);
            off(this.ele, "mouseup", this.UP);
        } else {
            off(document, "mousemove", this.MOVE);
            off(document, "mouseup", this.UP);
        }
    }
    new Drag(div1);
</script>
</body>
</html>